SELECT
    CASE 1 WHEN 1 THEN 'A' ELSE J1.ACCNT_CODE END As Ledger,
    J1.ACCNT_CODE AS [Account Code],
    J2.DESCR AS [Account Name],
    J3.NAME As [IRDA GROUPING],
    J1.PERIOD as [Accounting Period],
    SUM(-J1.AMOUNT) As [Base Amount],
    J1.ANAL_T0 As [EXPENSE TYPE],
    J1.ANAL_T4 As [ACTIVITY],
    J10.NAME As [ACTIVITY NAME],
    LEFT(J12.NAME, 2) As DEPARTMENTS,
    (CASE WHEN J12ACE1.FIELD_TYPE = 1 THEN J12DUL1.A2225_DESCR ELSE CAST(J12AF1.EXT_FIXED_1 AS NVARCHAR(80)) END) As [MAIN DEPARTMENT],
    (CASE WHEN J12ACE3.FIELD_TYPE = 1 THEN J12DUL3.A2225_DESCR ELSE CAST(J12AF3.EXT_FIXED_3 AS NVARCHAR(80)) END) As [Sales/Support],
    (CASE WHEN J8ACE1.FIELD_TYPE = 1 THEN J8DUL1.A2225_DESCR ELSE CAST(J8AF1.EXT_FIXED_1 AS NVARCHAR(80)) END) As Channel
FROM
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_A_SALFLDG J1
INNER JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ACNT J2 ON J2.ACNT_CODE = J1.ACCNT_CODE
LEFT OUTER JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2A1 ON J2A1.ANL_CAT_ID='10' AND J2A1.ACNT_CODE=J2.ACNT_CODE
LEFT OUTER JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J3 ON J3.ANL_CAT_ID=J2A1.ANL_CAT_ID AND J3.ANL_CODE=J2A1.ANL_CODE
LEFT OUTER JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2BB1 ON J2BB1.ANL_CAT_ID='11' AND J2BB1.ACNT_CODE=J2.ACNT_CODE
LEFT OUTER JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J8 ON J8.ANL_CAT_ID='03' AND J8.ANL_CODE=J1.ANAL_T2
LEFT OUTER JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J10 ON J10.ANL_CAT_ID='05' AND J10.ANL_CODE=J1.ANAL_T4
LEFT JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J8ACE1 ON J8ACE1.ANL_CAT_ID=J8.ANL_CAT_ID AND J8ACE1.ASSIGNED_FIELD=16 
LEFT JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J8AF1 ON J8AF1.ANL_CODE=J8.ANL_CODE AND J8AF1.ANL_CAT_ID=03
LEFT JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST J8DUL1 ON J8DUL1.A2224_USER_LIST_CODE=J8ACE1.USER_LIST_CODE AND J8DUL1.A2225_VALUE_ID=J8AF1.EXT_FIXED_1 AND J8DUL1.A2226_LANG_CODE=J8DUL1.A2224_DFLT_LANG 
LEFT OUTER JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J12 ON J12.ANL_CAT_ID='07' AND J12.ANL_CODE=J1.ANAL_T6
LEFT JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J12AF1 ON J12AF1.ANL_CODE=J12.ANL_CODE AND J12AF1.ANL_CAT_ID=07
LEFT JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J12ACE1 ON J12ACE1.ANL_CAT_ID=J12.ANL_CAT_ID AND J12ACE1.ASSIGNED_FIELD=16
LEFT JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST J12DUL1 ON J12DUL1.A2224_USER_LIST_CODE=J12ACE1.USER_LIST_CODE AND J12DUL1.A2225_VALUE_ID=J12AF1.EXT_FIXED_1 AND J12DUL1.A2226_LANG_CODE=J12DUL1.A2224_DFLT_LANG 
LEFT JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J12AF3 ON J12AF3.ANL_CODE=J12.ANL_CODE AND J12AF3.ANL_CAT_ID=07
LEFT JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J12ACE3 ON J12ACE3.ANL_CAT_ID=J12.ANL_CAT_ID AND J12ACE3.ASSIGNED_FIELD=18 
LEFT JOIN 
    [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST J12DUL3 ON J12DUL3.A2224_USER_LIST_CODE=J12ACE3.USER_LIST_CODE AND J12DUL3.A2225_VALUE_ID=J12AF3.EXT_FIXED_3 AND J12DUL3.A2226_LANG_CODE=J12DUL3.A2224_DFLT_LANG 
WHERE
    1 = 1
    AND CASE 1 WHEN 1 THEN 'B' ELSE J1.ACCNT_CODE END = N'B'
    AND J1.PERIOD = 2024003
    AND J2BB1.ANL_CODE IN ('PNL06', 'PNL07')
GROUP BY 
    CASE 1 WHEN 1 THEN 'A' ELSE J1.ACCNT_CODE END,
    J1.ACCNT_CODE,
    J2.DESCR,
    J3.NAME,
    J1.PERIOD,
    J1.ANAL_T0,
    J1.ANAL_T4,
    J10.NAME,
    LEFT(J12.NAME, 2),
    (CASE WHEN J12ACE1.FIELD_TYPE = 1 THEN J12DUL1.A2225_DESCR ELSE CAST(J12AF1.EXT_FIXED_1 AS NVARCHAR(80)) END),
    (CASE WHEN J12ACE3.FIELD_TYPE = 1 THEN J12DUL3.A2225_DESCR ELSE CAST(J12AF3.EXT_FIXED_3 AS NVARCHAR(80)) END),
    (CASE WHEN J8ACE1.FIELD_TYPE = 1 THEN J8DUL1.A2225_DESCR ELSE CAST(J8AF1.EXT_FIXED_1 AS NVARCHAR(80)) END)
HAVING 
    SUM(-J1.AMOUNT) <> 0
