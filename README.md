SELECT
CASE 1 WHEN 1 THEN 'A' ELSE J1.ACCNT_CODE END As Ledger,
J3.NAME As Name,
concat_ws('/',left(J1.PERIOD,4),right(J1.PERIOD,3)) as [Accounting Period],
SUM( - J1.AMOUNT ) As [Base Amount],
J7.NAME As Product_Name,
(case when J8ACE1.FIELD_TYPE = 1 then J8DUL1.A2225_DESCR else cast(J8AF1.EXT_FIXED_1 as nvarchar(80)) end) As Channel,
(case when J8ACE2.FIELD_TYPE = 1 then J8DUL2.A2225_DESCR else cast(J8AF2.EXT_FIXED_2 as nvarchar(80)) end) As SubChannel,
J8.NAME As Verticals,
(case when J7ACE6.FIELD_TYPE = 1 then J7DUL6.A2225_DESCR else cast(J7AF6.EXT_FIXED_6 as nvarchar(80)) end) As Sub_Segment,
(case when J7ACE4.FIELD_TYPE = 1 then J7DUL4.A2225_DESCR else cast(J7AF4.EXT_FIXED_4 as nvarchar(80)) end) As Product_Nature,
(case when J7ACE3.FIELD_TYPE = 1 then J7DUL3.A2225_DESCR else cast(J7AF3.EXT_FIXED_3 as nvarchar(80)) end) As Retial_Grp,
(case when J11ACE2.FIELD_TYPE = 1 then J11DUL2.A2225_DESCR else cast(J11AF2.EXT_FIXED_2 as nvarchar(80)) end) As PPT_Slabs
--into #LedgerA

FROM
(((((((((((((([SUNBALICBP].[dbo].FPA_A_SALFLDG
/*ALCHEMY CREATE VIRTUAL TABLE MODIFY VALUE FilterKey1/LA/Ldg SINGLE LETTER CYCLE VALUES B*/ J1 
 INNER JOIN [SUNBALICBP].[dbo].FPA_ACNT J2 ON J2.ACNT_CODE = J1.ACCNT_CODE)
 LEFT OUTER JOIN [SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2A1 ON J2A1.ANL_CAT_ID='10' AND J2A1.ACNT_CODE=J2.ACNT_CODE
LEFT OUTER JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE J3 ON  J3.ANL_CAT_ID=J2A1.ANL_CAT_ID AND J3.ANL_CODE =J2A1.ANL_CODE)
 LEFT OUTER JOIN [SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2B1 ON J2B1.ANL_CAT_ID='11' AND J2B1.ACNT_CODE=J2.ACNT_CODE
LEFT OUTER JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE J4 ON  J4.ANL_CAT_ID=J2B1.ANL_CAT_ID AND J4.ANL_CODE =J2B1.ANL_CODE)
  LEFT OUTER JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE J7 ON  J7.ANL_CAT_ID='02' AND J7.ANL_CODE =J1.ANAL_T1)
LEFT OUTER JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE J8 ON  J8.ANL_CAT_ID='03' AND J8.ANL_CODE =J1.ANAL_T2)
 LEFT OUTER JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE J11 ON  J11.ANL_CAT_ID='06' AND J11.ANL_CODE =J1.ANAL_T5)

 LEFT OUTER JOIN [SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2AA1 ON J2AA1.ANL_CAT_ID='10' AND J2AA1.ACNT_CODE=J2.ACNT_CODE)
 LEFT OUTER JOIN [SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2BB1 ON J2BB1.ANL_CAT_ID='11' AND J2BB1.ACNT_CODE=J2.ACNT_CODE)

 LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J7AF4 ON J7AF4.ANL_CODE = J7.ANL_CODE and J7AF4.ANL_CAT_ID = 02 LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J7ACE4 on J7ACE4.ANL_CAT_ID = J7.ANL_CAT_ID  and J7ACE4.ASSIGNED_FIELD = 19 left join [SUNBALICBP].[dbo].V_DOMN_USER_LIST J7DUL4 on J7DUL4.A2224_USER_LIST_CODE = J7ACE4.USER_LIST_CODE and J7DUL4.A2225_VALUE_ID = J7AF4.EXT_FIXED_4 and J7DUL4.A2226_LANG_CODE = J7DUL4.A2224_DFLT_LANG  and ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J7ACE4.USER_LIST_CODE and A2225_VALUE_ID = J7AF4.EXT_FIXED_4 and A2225_LANG_CODE = 1 ) > 0 and (J7DUL4.A2225_LANG_CODE = 1 ) or ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J7ACE4.USER_LIST_CODE and A2225_VALUE_ID = J7AF4.EXT_FIXED_4 and A2225_LANG_CODE = 1 ) = 0 and J7DUL4.A2224_DFLT_LANG = J7DUL4.A2225_LANG_CODE)))

   LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J7AF6 ON J7AF6.ANL_CODE = J7.ANL_CODE and J7AF6.ANL_CAT_ID = 02 LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J7ACE6 on J7ACE6.ANL_CAT_ID = J7.ANL_CAT_ID  and J7ACE6.ASSIGNED_FIELD = 21 left join [SUNBALICBP].[dbo].[V_DOMN_USER_LIST] J7DUL6 on J7DUL6.A2224_USER_LIST_CODE = J7ACE6.USER_LIST_CODE and J7DUL6.A2225_VALUE_ID = J7AF6.EXT_FIXED_6 and J7DUL6.A2226_LANG_CODE = J7DUL6.A2224_DFLT_LANG  and ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J7ACE6.USER_LIST_CODE and A2225_VALUE_ID = J7AF6.EXT_FIXED_6 and A2225_LANG_CODE = 1 ) > 0 and (J7DUL6.A2225_LANG_CODE = 1 ) or ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J7ACE6.USER_LIST_CODE and A2225_VALUE_ID = J7AF6.EXT_FIXED_6 and A2225_LANG_CODE = 1 ) = 0 and J7DUL6.A2224_DFLT_LANG = J7DUL6.A2225_LANG_CODE)))
   LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J8AF1 ON J8AF1.ANL_CODE = J8.ANL_CODE and J8AF1.ANL_CAT_ID = 03 LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J8ACE1 on J8ACE1.ANL_CAT_ID = J8.ANL_CAT_ID  and J8ACE1.ASSIGNED_FIELD = 16 left join [SUNBALICBP].[dbo].V_DOMN_USER_LIST J8DUL1 on J8DUL1.A2224_USER_LIST_CODE = J8ACE1.USER_LIST_CODE and J8DUL1.A2225_VALUE_ID = J8AF1.EXT_FIXED_1 and J8DUL1.A2226_LANG_CODE = J8DUL1.A2224_DFLT_LANG  and ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J8ACE1.USER_LIST_CODE and A2225_VALUE_ID = J8AF1.EXT_FIXED_1 and A2225_LANG_CODE = 1 ) > 0 and (J8DUL1.A2225_LANG_CODE = 1 ) or ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J8ACE1.USER_LIST_CODE and A2225_VALUE_ID = J8AF1.EXT_FIXED_1 and A2225_LANG_CODE = 1 ) = 0 and J8DUL1.A2224_DFLT_LANG = J8DUL1.A2225_LANG_CODE)))

 LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J8AF2 ON J8AF2.ANL_CODE = J8.ANL_CODE and J8AF2.ANL_CAT_ID = 03 LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J8ACE2 on J8ACE2.ANL_CAT_ID = J8.ANL_CAT_ID  and J8ACE2.ASSIGNED_FIELD = 17 left join [SUNBALICBP].[dbo].V_DOMN_USER_LIST J8DUL2 on J8DUL2.A2224_USER_LIST_CODE = J8ACE2.USER_LIST_CODE and J8DUL2.A2225_VALUE_ID = J8AF2.EXT_FIXED_2 and J8DUL2.A2226_LANG_CODE = J8DUL2.A2224_DFLT_LANG  and ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J8ACE2.USER_LIST_CODE and A2225_VALUE_ID = J8AF2.EXT_FIXED_2 and A2225_LANG_CODE = 1 ) > 0 and (J8DUL2.A2225_LANG_CODE = 1 ) or ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J8ACE2.USER_LIST_CODE and A2225_VALUE_ID = J8AF2.EXT_FIXED_2 and A2225_LANG_CODE = 1 ) = 0 and J8DUL2.A2224_DFLT_LANG = J8DUL2.A2225_LANG_CODE)))

 LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J7AF3 ON J7AF3.ANL_CODE = J7.ANL_CODE and J7AF3.ANL_CAT_ID = 02 LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J7ACE3 on J7ACE3.ANL_CAT_ID = J7.ANL_CAT_ID  and J7ACE3.ASSIGNED_FIELD = 18 left join [SUNBALICBP].[dbo].V_DOMN_USER_LIST J7DUL3 on J7DUL3.A2224_USER_LIST_CODE = J7ACE3.USER_LIST_CODE and J7DUL3.A2225_VALUE_ID = J7AF3.EXT_FIXED_3 and J7DUL3.A2226_LANG_CODE = J7DUL3.A2224_DFLT_LANG  and ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J7ACE3.USER_LIST_CODE and A2225_VALUE_ID = J7AF3.EXT_FIXED_3 and A2225_LANG_CODE = 1 ) > 0 and (J7DUL3.A2225_LANG_CODE = 1 ) or ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J7ACE3.USER_LIST_CODE and A2225_VALUE_ID = J7AF3.EXT_FIXED_3 and A2225_LANG_CODE = 1 ) = 0 and J7DUL3.A2224_DFLT_LANG = J7DUL3.A2225_LANG_CODE)))
LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J11AF2 ON J11AF2.ANL_CODE = J11.ANL_CODE and J11AF2.ANL_CAT_ID = 06 LEFT JOIN [SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J11ACE2 on J11ACE2.ANL_CAT_ID = J11.ANL_CAT_ID  and J11ACE2.ASSIGNED_FIELD = 17 left join [SUNBALICBP].[dbo].V_DOMN_USER_LIST J11DUL2 on J11DUL2.A2224_USER_LIST_CODE = J11ACE2.USER_LIST_CODE and J11DUL2.A2225_VALUE_ID = J11AF2.EXT_FIXED_2 and J11DUL2.A2226_LANG_CODE = J11DUL2.A2224_DFLT_LANG  and ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J11ACE2.USER_LIST_CODE and A2225_VALUE_ID = J11AF2.EXT_FIXED_2 and A2225_LANG_CODE = 1 ) > 0 and (J11DUL2.A2225_LANG_CODE = 1 ) or ((select count(*) from [SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J11ACE2.USER_LIST_CODE and A2225_VALUE_ID = J11AF2.EXT_FIXED_2 and A2225_LANG_CODE = 1 ) = 0 and J11DUL2.A2224_DFLT_LANG = J11DUL2.A2225_LANG_CODE)))


WHERE
1=1
 AND 1=1
 AND 1=1
AND CASE 1 WHEN 1 THEN 'B' ELSE J1.ACCNT_CODE END
=N'B'
AND J1.PERIOD IN (2024001
--2024002,
--2024003,
--2024004,
--2024005,
--2024006,
--2024007,
--2024008,
--2024009,
--2024010,
--2024011,
--2024012
)

AND J2BB1.ANL_CODE IN ('PNL06','PNL07','PNL13','PNL14','PNL15')


GROUP BY 
CASE 1 WHEN 1 THEN 'A' ELSE J1.ACCNT_CODE END,
J3.NAME,
concat_ws('/',left(J1.PERIOD,4),right(J1.PERIOD,3)),
J7.NAME,
(case when J7ACE6.FIELD_TYPE = 1 then J7DUL6.A2225_DESCR else cast(J7AF6.EXT_FIXED_6 as nvarchar(80)) end),
(case when J8ACE1.FIELD_TYPE = 1 then J8DUL1.A2225_DESCR else cast(J8AF1.EXT_FIXED_1 as nvarchar(80)) end),
(case when J8ACE2.FIELD_TYPE = 1 then J8DUL2.A2225_DESCR else cast(J8AF2.EXT_FIXED_2 as nvarchar(80)) end),
J8.NAME,
(case when J7ACE4.FIELD_TYPE = 1 then J7DUL4.A2225_DESCR else cast(J7AF4.EXT_FIXED_4 as nvarchar(80)) end),
(case when J7ACE3.FIELD_TYPE = 1 then J7DUL3.A2225_DESCR else cast(J7AF3.EXT_FIXED_3 as nvarchar(80)) end),
--J1.ANAL_T0,
(case when J11ACE2.FIELD_TYPE = 1 then J11DUL2.A2225_DESCR else cast(J11AF2.EXT_FIXED_2 as nvarchar(80)) end)
