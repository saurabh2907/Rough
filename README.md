SELECT
CASE 1 WHEN 1 THEN 'A' ELSE J1.ACCNT_CODE END As Ledger,
J1.ACCNT_CODE AS [Account Code],
J2.DESCR AS [Account Name],
--J4.NAME As PTT_Naturewise_Name,
--J2AA1.ANL_CODE As A0_IRDA_GPR,
J3.NAME As [IRDA GROUPING],
J1.PERIOD as [Accounting Period],
SUM( - J1.AMOUNT ) As [Base Amount],
J1.ANAL_T0 As [EXPENSE TYPE],
J1.ANAL_T4 As [ACTIVITY],
J10.NAME As [ACTIVITY NAME],
left(J12.NAME,2) As DEPARTMENTS,
(case when J12ACE1.FIELD_TYPE = 1 then J12DUL1.A2225_DESCR else cast(J12AF1.EXT_FIXED_1 as nvarchar(80)) end) As [MAIN DEPARTMENT],
(case when J12ACE3.FIELD_TYPE = 1 then J12DUL3.A2225_DESCR else cast(J12AF3.EXT_FIXED_3 as nvarchar(80)) end) As [Sales/Support],


(case when J8ACE1.FIELD_TYPE = 1 then J8DUL1.A2225_DESCR else cast(J8AF1.EXT_FIXED_1 as nvarchar(80)) end) As Channel


FROM
		[L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_A_SALFLDG J1

INNER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ACNT J2
	ON J2.ACNT_CODE = J1.ACCNT_CODE

LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2A1 ON J2A1.ANL_CAT_ID='10' AND J2A1.ACNT_CODE=J2.ACNT_CODE

LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J3 ON  J3.ANL_CAT_ID=J2A1.ANL_CAT_ID AND J3.ANL_CODE =J2A1.ANL_CODE


--LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2AA1 
--	ON J2AA1.ANL_CAT_ID='10' AND J2AA1.ACNT_CODE=J2.ACNT_CODE

 LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2BB1 
 ON J2BB1.ANL_CAT_ID='11' AND J2BB1.ACNT_CODE=J2.ACNT_CODE


 LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ACNT_ANL_CAT J2B1 
	ON J2B1.ANL_CAT_ID='11' AND J2B1.ACNT_CODE=J2.ACNT_CODE


LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J4 
	ON  J4.ANL_CAT_ID=J2B1.ANL_CAT_ID AND J4.ANL_CODE =J2B1.ANL_CODE


LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J8 
	ON  J8.ANL_CAT_ID='03' AND J8.ANL_CODE =J1.ANAL_T2

LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J10 
	ON  J10.ANL_CAT_ID='05' AND J10.ANL_CODE =J1.ANAL_T4

 LEFT JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J8ACE1 
	on J8ACE1.ANL_CAT_ID = J8.ANL_CAT_ID  and J8ACE1.ASSIGNED_FIELD = 16 

 LEFT JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J8AF1 
	ON J8AF1.ANL_CODE = J8.ANL_CODE and J8AF1.ANL_CAT_ID = 03

 left join [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST J8DUL1 
	on J8DUL1.A2224_USER_LIST_CODE = J8ACE1.USER_LIST_CODE and J8DUL1.A2225_VALUE_ID = J8AF1.EXT_FIXED_1 and J8DUL1.A2226_LANG_CODE = J8DUL1.A2224_DFLT_LANG  
	and ((select count(*) from [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J8ACE1.USER_LIST_CODE and A2225_VALUE_ID = J8AF1.EXT_FIXED_1 and A2225_LANG_CODE = 1 ) > 0 and (J8DUL1.A2225_LANG_CODE = 1 ) 
	or ((select count(*) from [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J8ACE1.USER_LIST_CODE and A2225_VALUE_ID = J8AF1.EXT_FIXED_1 and A2225_LANG_CODE = 1 ) = 0 and J8DUL1.A2224_DFLT_LANG = J8DUL1.A2225_LANG_CODE))

 LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J11 
	ON  J11.ANL_CAT_ID='06' AND J11.ANL_CODE =J1.ANAL_T5
 
 LEFT JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J11AF1 
	ON J11AF1.ANL_CODE = J11.ANL_CODE and J11AF1.ANL_CAT_ID = 06 
 
 LEFT JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J11ACE1 
	on J11ACE1.ANL_CAT_ID = J11.ANL_CAT_ID  and J11ACE1.ASSIGNED_FIELD = 16 
 
 left join [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST J11DUL1 
	on J11DUL1.A2224_USER_LIST_CODE = J11ACE1.USER_LIST_CODE and J11DUL1.A2225_VALUE_ID = J11AF1.EXT_FIXED_1 and J11DUL1.A2226_LANG_CODE = J11DUL1.A2224_DFLT_LANG  
	and ((select count(*) from [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J11ACE1.USER_LIST_CODE and A2225_VALUE_ID = J11AF1.EXT_FIXED_1 and A2225_LANG_CODE = 1 ) > 0 and (J11DUL1.A2225_LANG_CODE = 1 ) 
	or ((select count(*) from [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J11ACE1.USER_LIST_CODE and A2225_VALUE_ID = J11AF1.EXT_FIXED_1 and A2225_LANG_CODE = 1 ) = 0 and J11DUL1.A2224_DFLT_LANG = J11DUL1.A2225_LANG_CODE))

 LEFT OUTER JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE J12 
	ON  J12.ANL_CAT_ID='07' AND J12.ANL_CODE =J1.ANAL_T6

 LEFT JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J12AF1 
	ON J12AF1.ANL_CODE = J12.ANL_CODE and J12AF1.ANL_CAT_ID = 07 

 LEFT JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J12ACE1 
	on J12ACE1.ANL_CAT_ID = J12.ANL_CAT_ID  and J12ACE1.ASSIGNED_FIELD = 16 

 left join [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST J12DUL1 
	on J12DUL1.A2224_USER_LIST_CODE = J12ACE1.USER_LIST_CODE and J12DUL1.A2225_VALUE_ID = J12AF1.EXT_FIXED_1 and J12DUL1.A2226_LANG_CODE = J12DUL1.A2224_DFLT_LANG  
	and ((select count(*) from [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J12ACE1.USER_LIST_CODE and A2225_VALUE_ID = J12AF1.EXT_FIXED_1 and A2225_LANG_CODE = 1 ) > 0 and (J12DUL1.A2225_LANG_CODE = 1 ) 
	or ((select count(*) from [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J12ACE1.USER_LIST_CODE and A2225_VALUE_ID = J12AF1.EXT_FIXED_1 and A2225_LANG_CODE = 1 ) = 0 and J12DUL1.A2224_DFLT_LANG = J12DUL1.A2225_LANG_CODE))

LEFT JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CODE_EXT J12AF3 
	ON J12AF3.ANL_CODE = J12.ANL_CODE and J12AF3.ANL_CAT_ID = 07 

LEFT JOIN [L1SRW2SUN04].[SUNBALICBP].[dbo].FPA_ANL_CAT_EXT J12ACE3 
	on J12ACE3.ANL_CAT_ID = J12.ANL_CAT_ID  and J12ACE3.ASSIGNED_FIELD = 18 

left join [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST J12DUL3 
	on J12DUL3.A2224_USER_LIST_CODE = J12ACE3.USER_LIST_CODE and J12DUL3.A2225_VALUE_ID = J12AF3.EXT_FIXED_3 and J12DUL3.A2226_LANG_CODE = J12DUL3.A2224_DFLT_LANG  
	and ((select count(*) from [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J12ACE3.USER_LIST_CODE and A2225_VALUE_ID = J12AF3.EXT_FIXED_3 and A2225_LANG_CODE = 1 ) > 0 and (J12DUL3.A2225_LANG_CODE = 1 ) 
	or ((select count(*) from [L1SRW2SUN04].[SUNBALICBP].[dbo].V_DOMN_USER_LIST where A2225_USER_LIST_CODE = J12ACE3.USER_LIST_CODE and A2225_VALUE_ID = J12AF3.EXT_FIXED_3 and A2225_LANG_CODE = 1 ) = 0 and J12DUL3.A2224_DFLT_LANG = J12DUL3.A2225_LANG_CODE))

WHERE
1=1
 AND 1=1
 AND 1=1
AND CASE 1 WHEN 1 THEN 'B' ELSE J1.ACCNT_CODE END
=N'B'
AND J1.PERIOD = 2024003
AND J2BB1.ANL_CODE IN ('PNL06', 'PNL07')

--AND J1.PERIOD in (2023001,2023002, 2023003, 2023004, 2023005, 2023006)
--AND J1.PERIOD in (2023007,2023008, 2023009, 2023010, 2023011, 2023012)

GROUP BY 
CASE 1 WHEN 1 THEN 'A' ELSE J1.ACCNT_CODE END,
J1.ACCNT_CODE,
J2.DESCR,
--J4.NAME As PTT_Naturewise_Name,
--J2AA1.ANL_CODE As A0_IRDA_GPR,
J3.NAME,
J1.PERIOD,
J1.ANAL_T0 ,
J1.ANAL_T4 ,
J10.NAME ,
left(J12.NAME,2),
(case when J12ACE1.FIELD_TYPE = 1 then J12DUL1.A2225_DESCR else cast(J12AF1.EXT_FIXED_1 as nvarchar(80)) end),
(case when J12ACE3.FIELD_TYPE = 1 then J12DUL3.A2225_DESCR else cast(J12AF3.EXT_FIXED_3 as nvarchar(80)) end),

(case when J8ACE1.FIELD_TYPE = 1 then J8DUL1.A2225_DESCR else cast(J8AF1.EXT_FIXED_1 as nvarchar(80)) end)

HAVING SUM( - J1.AMOUNT ) <> 0
